tosca_definitions_version: cloudify_dsl_1_2

imports:
  - http://10.60.0.12:8000/cloudify-types.yaml
  - http://10.60.0.12:8000/fabric-plugin.yaml
  - http://10.60.0.12:8000/openstack-plugin.yaml
  - plugins/cloudify-proxy-plugin/plugin.yaml


inputs:
  image_id:
      default: '4d4ae412-adec-41e5-ab75-4bf875fc5d9f'
      type: string

  flavor_id:
      default: '3'
      type: string

  lb_network:
      type: string
      description: LB Network resource id attached to

  app_network:
        type: string
        description: APP Network resource id attached to
        
  lb_network_subnet:
      type: string
      description: LB Network resource id attached to

  app_network_subnet:
        type: string
        description: APP Network resource id attached to



node_templates:

# Reference LB and Application Networks
  lb_network:
    type: cloudify.openstack.nodes.Network
    properties:
      resource_id: { get_input: lb_network }
      use_external_resource : true

  app_network:
    type: cloudify.openstack.nodes.Network
    properties:
      resource_id: { get_input: app_network }
      use_external_resource : true


# Create a LB VM

  fw_vm:
    type: cloudify.openstack.nodes.Server
    properties:
      server:
        image: { get_input: image_id }
        flavor: { get_input: flavor_id }
      install_agent: false
    relationships:
      - target: lb_network
        type: cloudify.relationships.connected_to
      - target: app_network
        type: cloudify.relationships.connected_to

