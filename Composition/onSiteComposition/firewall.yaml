tosca_definitions_version: cloudify_dsl_1_2

imports:
  - http://10.60.0.12:8000/cloudify-types.yaml
  - http://10.60.0.12:8000/fabric-plugin.yaml
  - http://10.60.0.12:8000/openstack-plugin.yaml
  - plugins/cloudify-proxy-plugin/plugin.yaml


inputs:
  image_id:
      default: '3cc7d237-2009-48a8-8dee-cb956d70f057'
      type: string

  flavor_id:
      default: '3'
      type: string

  lb_network1:
      type: string
      description: LB Network resource id attached to

  app_network2:
        type: string
        description: APP Network resource id attached to
        
  lb_network1_subnet:
      type: string
      description: LB Network resource id attached to

  app_network2_subnet:
        type: string
        description: APP Network resource id attached to



node_templates:

# Reference LB and Application Networks
  fw_network1:
    type: cloudify.openstack.nodes.Network
    properties:
      resource_id: { get_input: lb_network1 }
      use_external_resource : true

  fw_network2:
    type: cloudify.openstack.nodes.Network
    properties:
      resource_id: { get_input: app_network2 }
      use_external_resource : true


# Create a LB VM

  fw_vm:
    type: cloudify.openstack.nodes.Server
    properties:
      server:
        image: { get_input: image_id }
        flavor: { get_input: flavor_id }
    relationships:
      - target: fw_network1
        type: cloudify.relationships.connected_to
      - target: fw_network2
        type: cloudify.relationships.connected_to

